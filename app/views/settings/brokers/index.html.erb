<div>
  <div class="mt-1 mb-4 flex items-center w-full">
    <span class="w-1/3">
      <%= link_to dashboard_path, class: "inline-flex justify-between items-center p-2 text-xs border border-gray-200 rounded-lg bg-white hover:shadow-md transition-all" do %>
        <div class="flex items-center gap-1">
          <span class="text-gray-800"><%= render 'icons/back' %></span>
          <div class="flex flex-col">
            <span class="text-gray-500">Back</span>
          </div>
        </div>
      <% end %>
    </span>

    <span class="w-1/3 text-black text-base font-semibold flex justify-center">Brokers</span>
    <span class="w-1/3 flex justify-end">
      <%= render 'shared/breadcrumb', record_class: 'Brokers' %>
    </span>
  </div>
  
  <div class="flex gap-4">
    <div class="w-full border border-gray-200 rounded-lg bg-white/50 project-height-fix min-h-[calc(100vh-150px)]">
      <div class="">
        <div class="flex justify-between p-2 items-center">
          <%= form_with url: settings_brokers_path, method: :get, class: "flex gap-2" do |form| %>
            <%= form.text_field :search, 
                  value: params[:search],
                  placeholder: "Search by name, firm name, email or mobile...", 
                  class: "h-auto p-2.5 min-w-[400px] rounded border-gray-300" %>
            <%= form.button type: :submit, class: "bg-brand h-auto py-2 px-4 gap-2 hover:bg-brand/80 rounded text-white" do %>
              <%= render 'icons/searchsm' %>
            <% end %>
            <%= link_to settings_brokers_path, class: "h-auto py-2 px-4 gap-2 rounded text-white flex items-center transition-colors #{params[:search].present? ? 'bg-gray-500 hover:bg-gray-600' : 'bg-gray-300 cursor-not-allowed'}" do %>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
              </svg>
              <span class="ml-1">Reset</span>
            <% end %>
            <%= render 'layouts/advanced_search', klass: 'Broker' %>
          <% end %>
          
          <div class="ml-auto flex gap-2">
            <%= render_sheet direction: "right", width: "w-full sm:max-w-full lg:max-w-full  md:w-3/5 lg:w-3/5 xl:w-1/2 ",  class:"!slide-in-from-right bg-white/50 backdrop-blur-xl p-0" do %>
              <%= sheet_trigger do %>
                <%= render_button as: :link, href: "", class: "bg-brand/5 text-brand border border-gray-200 gap-2 hover:bg-brand hover:text-white" do %>
                  <%= render 'icons/add' %>
                  <span>Add Broker</span>
                <% end %> 
              <% end %>

              <%= sheet_content do %>
                <%= render 'form', broker: Broker.new %>
              <% end %>
            <% end %>
          </div>
        </div>
        
        <div class="table-responsive">
          <%= render_table class: "overflow-hidden" do %>
            <%= table_head class: "rounded-t-md py-2 px-4 bg-gradient-to-bl from-[#ffe4e6] to-[#ccfbf1]" do %>
              <%= table_header do %>
                <span class="text-gray-700 text-sm font-bold block">Name</span>
              <% end %>
              <%= table_header do %>
                <span class="text-gray-700 text-sm font-bold block">Firm Name</span>
              <% end %>
              <%= table_header do %>
                <span class="text-gray-700 text-sm font-bold block">Email</span>
              <% end %>
              <%= table_header do %>
                <span class="text-gray-700 text-sm font-bold block">Mobile</span>
              <% end %>
              <%= table_header do %>
                <span class="text-gray-700 text-sm font-bold block">Code</span>
              <% end %>
              <%= table_header do %>
                <span class="text-gray-700 text-sm font-bold block">RERA</span>
              <% end %>
              <%= table_header do %>
                <span class="text-gray-700 text-sm font-bold block">Status</span>
              <% end %>
              <%= table_header do %>
                <span class="text-gray-700 text-sm font-bold block">Action</span>
              <% end %>
            <% end %>
            
            <%= table_body do %>
              <% if @brokers.any? %>
                <% @brokers.each do |broker| %>
                  <%= table_row do %>
                    <%= table_column do %>
                      <div class="whitespace-nowrap">
                        <%= broker.name %>
                      </div>
                    <% end %>
                    <%= table_column do %>
                      <div class="whitespace-nowrap font-medium text-brand">
                        <%= broker.firm_name %>
                      </div>
                    <% end %>
                    <%= table_column do %>
                      <div class="whitespace-nowrap">
                        <%= broker.email %>
                      </div>
                    <% end %>
                    <%= table_column do %>
                      <div class="whitespace-nowrap">
                        <%= broker.mobile %>
                      </div>
                    <% end %>
                    <%= table_column do %>
                      <div class="whitespace-nowrap">
                        <%= broker.code %>
                      </div>
                    <% end %>
                    <%= table_column do %>
                      <div class="whitespace-nowrap">
                        <% if broker.rera.present? %>
                          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            <%= broker.rera %>
                          </span>
                        <% else %>
                          <span class="text-gray-400 text-xs">Not provided</span>
                        <% end %>
                      </div>
                    <% end %>
                    <%= table_column do %>
                      <div class="whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                          Active
                        </span>
                      </div>
                    <% end %>
                    <%= table_column do %>
                      <div class="whitespace-nowrap flex">
                        <%= render 'layouts/action_buttons', 
                          record: broker, 
                          module_name: 'broker',
                          show_path: 'settings_broker',
                          edit_path: 'edit_settings_broker',
                          delete_path: 'settings_broker',
                          sheet: true
                        %>
                      </div>
                    <% end %>
                  <% end %>
                <% end %>
              <% else %>
                <%= table_row do %>
                  <%= table_column colspan: 8, class: "text-center py-8 text-gray-500" do %>
                    No brokers found.
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        </div>
        
        <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
          <% if @pagy.pages > 1 %>
            <%= render 'layouts/pagination', pagy: @pagy %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
